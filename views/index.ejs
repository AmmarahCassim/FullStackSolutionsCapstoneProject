<html>
  <head>
    <title>PidgeySync Prototype</title>
      <!-- <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"> -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
      <!-- <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script> -->
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.7.0/introjs.min.css">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
      <link rel="stylesheet" href="css/style.css">
      <link rel="icon" href="images/favicon.png" type="image/png">
  </head>
  <body id="body">
  	<div id="nav">
      <div id="navlogo"><img src="images/PidgeyBanner.png"></div>
      <div class="nav-link home">Home</div>      
      <div class="nav-link about">About</div>

      <div class="nav-link help">Need Help?</div>
      <div class="nav-link tour">Start Tour</div>
    </div>
  	<div id="main">
      <div id="modal-bg">
      </div>
      <div id="main-modal">
      	<div id='upload-title' class='title'>Upload Your Audio</div>
	        <div class="custom-file">
	        	<span class="button" style="font-family: Dubai;">Browse</span>
	      	   <input type="file" id="file" />
	 	 	</div> 
	        <button id='upload-button' class='button' style="font-family: Dubai;">Upload</button>
	        <span id='upload-text' class='text'>Nothing selected</span>
	    </div>
      	<div id="waveform">
      		<div id='upload-title' class='title'>Upload Your Audio</div>
      		<div id="browse-button" class="custom-file">
	        	<span class="button" style="font-family: Dubai;">Browse</span>
	      	   <input type="file" id="file" />
	 	 	</div>
      		<button id='upload-button' class='button'>Upload</button>
      		<button id='generate-button' class='button'>Generate</button>
      	</div>
      	<div id="generated">
      		
      	</div>
      	<div id="warnclose">
      		
      	</div>
      </div>
    </div>
  	<div id="footer">
  		<div class="crumb-container">
	  		<div id="upload-crumb" class="crumb"><img src="images/PidgeySync_Icons/upload_LB.png"></div>
	  		<div id="edit-crumb" class="crumb inactive"><img src="images/PidgeySync_Icons/edit_LB.png"></div>
	  		<div id="preview-crumb" class="crumb inactive"><img src="images/PidgeySync_Icons/preview_LB.png"></div>
	  		<div id="download-crumb" class="crumb inactive"><img src="images/PidgeySync_Icons/download_LB.png"></div>
      </div>
	    <!-- <footer>
	    	<em>&copy; 2018 Full Stack Solutions</em>
	    </footer> -->
    </div>
    <div id="about_popup">
        <img class="about-image" src="images/PidgeySyncLogo.png">
        <p class="about-text">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Corrupti fugit harum dicta autem quis!</p>
    </div>
    <script>
      $(function() {
        $(document).on("change", "#files", function() {
            $("#fileName").append($(this).val());
        });

        $(".about").click(function(){
          $("#about_popup").fadeToggle();
        });

        $("#modal-bg").click(function(){         
            $("#modal-bg").fadeOut();
            $("#main-modal").fadeOut();
        })

        $("#upload-crumb").click(function(){
          $("#modal-bg").fadeToggle();
          $("#main-modal").fadeToggle();
          $(this).addClass("active");
        });

        $("#upload-button").click(function(){
        	$("#upload-title").hide();
        	$("#waveform").show();
        });

        $("#main-modal").on("click","#upload-browse",function(){
          console.log("clicked browse upload");
        });
        $("#main-modal").on('change','#file',function(){
            $("#file-data").text(this.value);
        });
        
        $("#main-modal").on('hover','.custom-file', function(){
          console.log("hovered browse upload");
          $("span.button").css({
             "border-color":"#fdb400",
             "color":"#fdb400"}
          )
        });
        $("#main-modal").on('leave','.custom-file', function(){
          console.log("hovered browse upload");
          $("span.button").css({
             "border-color":"",
             "color":""}
          )
        });
      
        $(function() {
            $('#file').change(function(){
                $(this).siblings('.text').text(this.value || 'Nothing selected')
            });
        });
    });
    </script>
    <% if(files) {%>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
      <script src ="dist/wavesurfer.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.2.3/wavesurfer.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.2.3/plugin/wavesurfer.timeline.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.2.3/plugin/wavesurfer.regions.min.js"></script>
      <script src="javascript/scriptOne.js"/>
      <!--<script src="javascript/script.js"/>-->
    <%}%>

  </body>
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.7.0/intro.min.js"></script>  

    <script>
        $("#generate").click(function(e){
        $("#loading").append('<img src="loader.gif" alt="Smiley face" width="42" height="42" style="z-index:1;position:absolute;margin:5% 10% 5% 35%;">');
		    $.get("/text", function(data, status){
        console.log("I AM WORKING");
        $("textarea").append(data.toString()); 
        $("#loading").empty();
        $("#breakdown").prop('disabled',false);
        $("#EXPORT").prop('disabled',false);
        $("#EMAIL").prop('disabled',false);
        $("#EDIT").prop('disabled',false);
      });
    });
    
   
    $("#EXPORT").click(function(){
      $.get("/pidgin_breakdown", function(data, status){
          console.log("Data: " + data + "\nStatus: " + status);
          $("#EandE").append("<h3 id='exFeedback' style='color:black; font-family: birdHouse;'>EXPORTED</h3>");
          $('#exFeedback').fadeOut('slow',function(){
            $('#EandE').empty();
          });
      });
          
    });


    $("#EDIT").click(function(){
      $("#loading").append('<img src="loader.gif" alt="Smiley face" width="42" height="42" style="z-index:1;position:absolute;margin:5% 10% 5% 35%;">');
      var text = $("#speechtotext").val();
      console.log(text);
      $.post("/update",{output: text},function(data,status){
        console.log("Data: " + data);
        $("#loading").empty();
        $("#loading").append("<h3 id='SAVED' style='font-family: birdHouse;color:black;position:absolute; z-index:1;margin:5% 10% 5% 35%;'>SAVED !</h3>");
        console.log("callback for edit returned");
        $('#SAVED').fadeOut('slow',function(){
            $('#loading').empty();
          });
      });  
    });

    var myIndex = 0;
    carousel();
    
    function carousel() {
        var i;
        var x = document.getElementsByClassName("slides");
        for (i = 0; i < x.length; i++) {
           x[i].style.display = "none";  
        }
        myIndex++;
        if (myIndex > x.length) {myIndex = 1}    
        x[myIndex-1].style.display = "block";  
        setTimeout(carousel, 300);
		}
		var xLoading = false;
    
		function move() 
		{
			document.getElementById('myProgress').style.display = "inherit";
			document.getElementById('myBar').style.display = "inherit";
			var elem = document.getElementById("myBar");  
			var width = 0;
		
			if (xLoading == false)
			{
				var id = setInterval(frame, 10);
				xLoading = true;
				function frame() 
				{
					if (width >= 100) 
					{
					clearInterval(id);
					} 
					else 
					{
						width+= 0.34; 
						elem.style.width = width + '%'; 
					}
				  }
				  setTimeout(hide, 4400);
			}
		}
			
		function hide()
		{
			xLoading = false;
			document.getElementById('myProgress').style.display = "none";
		}
		
		
	 function func()
	 {
		//alert("entering");
		 if (document.getElementById("uploadForm")) {
			//alert("We are here");
			var barMy = document.getElementById("myBar");
			var klas = document.createAttribute("class");
			klas.value = "progress-bar progress-bar-striped active"; 
			var rol = document.createAttribute("role");
			rol.value = "progressbar";
			
			barMy.setAttributeNode(klas);   
			barMy.setAttributeNode(rol);   
			//alert("Done must show");
			move();
			setTimeout(submitForm, 0000); 
		}
	}
	

	
    </script>
</html>